# 前言
本项目是树莓派识别数字的小例程
用于电赛备赛用

# 项目组成部分

## utils
提供hardware库，提供操纵树莓派GPIO和UART的函数。
提供num_detect库，提供数字图像变换的相关函数

## project
项目主程序代码，实现对1-8的数字识别并与下位机通信控制小车进行运动

### 主要实现思路
传统图像处理，使用模板匹配

### 主要步骤
1. 对模板图像进行预处理，得到1-8总共8个模板
2. 对识别图像进行预处理，将图像二值化转换取出矩形区域组成ROI区域
3. ROI和模板做模板匹配

### 详细过程

#### 模板图像预处理

模板预览图本身是含有八个数字带外接矩形黑框的一张图，我们对它作二值化处理，在对二值化模板图像边缘提取，通过轮廓检测将模板的轮廓提取，在将其外接矩形坐标画出来，在对不同数字1-8进行排序，最后将整个图像按比例内截，在重排成（100，150）的固定的模板存入字典。

#### 识别图像预处理

从摄像头获取视频流，将其缩放固定比例减少后续的运算量，转换为灰度图并应用高斯模糊将锐度过高的区域排除边缘和消除噪点，再使用Canny边缘检测，提取边缘后进行膨胀，得到识别数字完整的矩形边缘轮廓。通过轮廓检测再将轮廓面积最大的前5个轮廓进行提取并排序，计算轮廓周长，进行近似轮廓，看是否能构成四边形，将能构成四边形的轮廓且面积符合一定要求的轮廓进行筛选，并通过两个矩形左x坐标的大小来判断数字的左右并重排。本身通过相机拍到的矩形数字框就不可能是正好的矩形，需要我们进行图像变换，因此进行透射变换，将提取到的四边形变换成矩形然后二值化。

#### ROI区域

首先将图像预处理得到的二值化图像进行重排，变成（150，100）的图像，再进行高斯模糊和腐蚀操作滤除噪点，边缘检测再次提取矩形框边缘，轮廓检测提取矩形框轮廓，最后将整个图像按比例内截，在重排成（100，150）的ROI区域送给下步模板匹配。

#### 模板匹配
将字典里的数字与模板图像取出与识别图像的ROI区域进行模板匹配，找到最适合的数字，再进行个赋值。

#### 下位机通信
通过串口去传输数据，将左右数字传给下位机MCU进行进一步的控制。


# Test
实现项目的测试代码，是每个代码块的测试







